<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th·ªùi ti·∫øt & V√µ ƒë·∫°o</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #007bff;
      --text-light: #ffffff;
      --background-dark: #1a1a2e;
      --accent-color: #00d4ff;
      --transition-normal: all 0.3s ease-in-out;
    }

    body {
      background: linear-gradient(135deg, #f0f2f5, #dfe6e9);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      overflow-x: hidden;
    }

    .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
    .particle {
      position: absolute;
      background: radial-gradient(circle, rgba(0, 212, 255, 0.8), transparent);
      border-radius: 50%;
      opacity: 0.6;
      animation: float 15s infinite ease-in-out;
    }
    .particle:nth-child(1){width:20px;height:20px;top:10%;left:15%;animation-duration:12s;}
    .particle:nth-child(2){width:15px;height:15px;top:30%;left:40%;animation-duration:18s;}
    .particle:nth-child(3){width:25px;height:25px;top:50%;left:60%;animation-duration:14s;}
    .particle:nth-child(4){width:18px;height:18px;top:70%;left:25%;animation-duration:16s;}
    .particle:nth-child(5){width:22px;height:22px;top:20%;left:80%;animation-duration:20s;}
    @keyframes float {
      0%,100%{transform:translateY(0) scale(1);opacity:0.6;}
      50%{transform:translateY(-50px) scale(1.2);opacity:0.9;}
    }

    .glowing-border {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border: 4px solid transparent;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.5), inset 0 0 20px rgba(0, 212, 255, 0.5);
      pointer-events: none;
      z-index: 2;
      animation: glow 3s infinite ease-in-out;
    }
    @keyframes glow {
      0%,100%{box-shadow:0 0 20px rgba(0,212,255,0.5),inset 0 0 20px rgba(0,212,255,0.5);}
      50%{box-shadow:0 0 30px rgba(0,212,255,0.8),inset 0 0 30px rgba(0,212,255,0.8);}
    }

    .side-menu {
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100%;
      background: linear-gradient(180deg, var(--background-dark), #2d3436);
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
      transition: var(--transition-normal);
      z-index: 100;
    }
    .menu-toggle:hover + .side-menu, .side-menu:hover { left: 0; }
    .menu-toggle {
      position: fixed;
      top: 20px; left: 20px;
      width: 40px; height: 40px;
      background: var(--primary-color);
      border-radius: 50%;
      display: flex; justify-content: center; align-items: center;
      cursor: pointer; color: var(--text-light);
      z-index: 101;
    }
    .menu-toggle i { font-size: 1.5rem; }

    .menu-items { list-style: none; padding: 60px 20px; margin: 0; }
    .menu-item { margin: 15px 0; }
    .menu-item a {
      display: flex; align-items: center;
      padding: 12px;
      color: var(--text-light);
      text-decoration: none;
      font-size: 1.1rem; font-weight: 500;
      border-radius: 8px;
      transition: var(--transition-normal);
    }
    .menu-item a i { margin-right: 10px; font-size: 1.3rem; }
    .menu-item a:hover {
      background: var(--primary-color);
      transform: translateX(10px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .weather-box {
      position: fixed;
      left: 320px; top: 40px; right: 40px; bottom: 30px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 25px;
      backdrop-filter: blur(8px);
      padding: 35px;
      color: #222;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
      overflow-y: auto;
    }

    .weather-header { text-align: center; margin-bottom: 20px; }
    .weather-header h1 { font-size: 70px; margin: 10px 0; color: #007bff; }
    .weather-header h2 { margin: 5px 0; font-size: 1.6rem; }
    .city-select {
      width: 100%; padding: 12px;
      border-radius: 15px; border: 1px solid #ccc;
      text-align: center; background: #f9f9f9;
      font-size: 17px; margin-bottom: 10px;
    }

    .hourly-forecast {
      display: flex; gap: 15px;
      overflow-x: auto; margin-top: 15px; padding-bottom: 10px;
    }
    .hour-item {
      min-width: 150px; background: #fff; border-radius: 15px;
      text-align: center; padding: 15px 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s, background 0.3s;
    }
    .hour-item:hover { transform: scale(1.07); background: #e8f3ff; }

    #tempChart { width: 100% !important; height: 650px !important; margin-top: 40px; margin-bottom: 20px; }

    /* üîî Ph·∫ßn c·∫£nh b√°o */
    .alert-section {
      background: linear-gradient(135deg, #fff7e6, #fff0f0);
      border-left: 6px solid #ffa502;
      border-radius: 15px;
      padding: 20px;
      margin-top: 40px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.4s ease;
    }
    .alert-section h2 {
      font-size: 1.6rem;
      margin-bottom: 10px;
      color: #d35400;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .alert-content p {
      margin: 6px 0;
      font-size: 1.1rem;
      color: #444;
      opacity: 0;
      animation: fadeInUp 0.6s forwards;
    }
    @keyframes fadeInUp {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .alert-good {
      border-left-color: #2ecc71;
      background: linear-gradient(135deg, #eaffea, #f0fff5);
    }
    .alert-warning {
      border-left-color: #f1c40f;
      background: linear-gradient(135deg, #fffbe6, #fff9e6);
    }
    .alert-danger {
      border-left-color: #e74c3c;
      background: linear-gradient(135deg, #ffeaea, #fff0f0);
    }

    #extraMetrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 20px;
      text-align: center;
    }
    .metric-card {
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    .metric-card:hover { transform: translateY(-5px); }
    .metric-card i { font-size: 30px; color: var(--primary-color); margin-bottom: 10px; }

    .aqi-container {
      display: flex; flex-direction: column; gap: 8px; align-items: stretch; width: 100%;
    }
    .aqi-bar { height: 18px; border-radius: 12px; background: #e0e0e0; position: relative; overflow: hidden; }
    .aqi-fill {
      position: absolute; top: 0; left: 0; bottom: 0; width: 0%;
      border-radius: 12px;
      transition: width 0.6s ease-in-out, background 0.4s ease-in-out;
      opacity: 0.95;
    }
    .aqi-value-label { font-size: 0.95rem; color: #333; font-weight: 600; text-align: right; margin-top: 2px; }
  </style>
</head>
<body>
  <div class="particles"><div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div></div>
  <div class="glowing-border"></div>

  <div class="menu-toggle"><i class="fas fa-bars"></i></div>
  <nav class="side-menu">
    <ul class="menu-items">
      <li class="menu-item"><a href="vo-dao.html"><i class="fas fa-fist-raised"></i> V√ï ƒê·∫†O</a></li>
      <li class="menu-item"><a href="basic-techniques.html"><i class="fas fa-video"></i> VIDEO K·ª∏ THU·∫¨T</a></li>
      <li class="menu-item"><a href="tlk.html"><i class="fas fa-book"></i> C√ÅC T√ÄI LI·ªÜU KH√ÅC</a></li>
      <li class="menu-item"><a href="xemthem.html"><i class="fas fa-plus-circle"></i> XEM TH√äM</a></li>
      <li class="menu-item"><a href="ttlh.html"><i class="fas fa-envelope"></i> LI√äN H·ªÜ</a></li>
      <li class="menu-item"><a href="mp.html"><i class="fas fa-code"></i> M√î PH·ªéNG CODE</a></li>
      <li class="menu-item"><a href="khoahoc.html"><i class="fas fa-church"></i> KH√ìA H·ªåC</a></li>
    </ul>
  </nav>

  <div class="weather-box">
    <div class="weather-header">
      <select id="citySelect" class="city-select" onchange="getWeather(this.value)">
        <option value="current">üìç V·ªã tr√≠ c·ªßa b·∫°n</option>
        <option value="Ho Chi Minh">TP. H·ªì Ch√≠ Minh</option>
        <option value="Ha Noi">H√† N·ªôi</option>
        <option value="Da Nang">ƒê√† N·∫µng</option>
      </select>
      <h2 id="cityName">--</h2>
      <p id="weatherDesc">--</p>
      <h1 id="temp">--¬∞C</h1>
      <p id="humidity">ƒê·ªô ·∫©m: --%</p>
    </div>

    <div id="hourlyForecast" class="hourly-forecast"></div>
    <canvas id="tempChart"></canvas>

    <!-- üîî Ph·∫ßn c·∫£nh b√°o -->
    <div id="alertSection" class="alert-section">
      <h2><i class="fas fa-exclamation-triangle"></i> C·∫£nh b√°o th·ªùi ti·∫øt</h2>
      <div id="alertContent" class="alert-content">
        <p>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</p>
      </div>
    </div>

    <div id="extraMetrics">
      <div class="metric-card">
        <i class="fas fa-wind"></i>
        <h3>T·ªëc ƒë·ªô gi√≥</h3>
        <p id="windSpeed">-- m/s</p>
      </div>
      <div class="metric-card">
        <i class="fas fa-eye"></i>
        <h3>T·∫ßm nh√¨n</h3>
        <p id="visibility">-- km</p>
      </div>
      <div class="metric-card">
        <i class="fas fa-sun"></i>
        <h3>Ch·ªâ s·ªë UV</h3>
        <p id="uvIndex">--</p>
      </div>
      <div class="metric-card">
        <i class="fas fa-smog"></i>
        <h3>Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠ (AQI)</h3>
        <div class="aqi-container">
          <div class="aqi-bar"><div id="aqiFill" class="aqi-fill"></div></div>
          <div id="aqiValue" class="aqi-value-label">-- / 100</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const apiKey = "3be4efb527a7c1e6fce941a0a8a7f541";

    function formatTime(unix) {
      return new Date(unix * 1000).toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
    }

    async function getWeather(city = "current") {
      try {
        if (city === "current" && navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(async pos => {
            const { latitude, longitude } = pos.coords;
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=metric&lang=vi&appid=${apiKey}`);
            const data = await res.json();
            showWeather(data);
            getForecast(latitude, longitude);
            getExtraData(latitude, longitude);
          }, () => getWeather("Ho Chi Minh"));
        } else {
          const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},VN&units=metric&lang=vi&appid=${apiKey}`);
          const data = await res.json();
          showWeather(data);
          getForecast(data.coord.lat, data.coord.lon);
          getExtraData(data.coord.lat, data.coord.lon);
        }
      } catch (err) {
        console.error("L·ªói t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt:", err);
      }
    }

    async function getForecast(lat, lon) {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=vi&appid=${apiKey}`);
      const data = await res.json();
      const hourly = document.getElementById("hourlyForecast");
      hourly.innerHTML = "";
      data.list.slice(0, 12).forEach(item => {
        hourly.innerHTML += `
          <div class="hour-item">
            <span>${formatTime(item.dt)}</span>
            <img src="https://openweathermap.org/img/wn/${item.weather[0].icon}@2x.png">
            <span>${Math.round(item.main.temp)}¬∞C</span>
            <span>üíß${item.main.humidity}%</span>
          </div>`;
      });

      const ctx = document.getElementById('tempChart').getContext('2d');
      if (window.tempChartInstance) window.tempChartInstance.destroy();
      const hours = data.list.slice(0, 12).map(i => formatTime(i.dt));
      const temps = data.list.slice(0, 12).map(i => i.main.temp);
      const hums = data.list.slice(0, 12).map(i => i.main.humidity);
      window.tempChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: hours,
          datasets: [
            { label: 'Nhi·ªát ƒë·ªô (¬∞C)', data: temps, borderColor: '#ff4b4b', backgroundColor: 'rgba(255,75,75,0.15)', tension: 0.4, pointBackgroundColor: '#ff4b4b', yAxisID: 'y1' },
            { label: 'ƒê·ªô ·∫©m (%)', data: hums, borderColor: '#00d4ff', backgroundColor: 'rgba(0,212,255,0.15)', tension: 0.4, pointBackgroundColor: '#00d4ff', yAxisID: 'y2' }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y1: { position: 'left', ticks: { color: '#ff4b4b' } },
            y2: { position: 'right', grid: { drawOnChartArea: false }, ticks: { color: '#00d4ff' } }
          },
          plugins: { legend: { position: 'top' } }
        }
      });
    }

    async function getExtraData(lat, lon) {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`);
      const data = await res.json();
      const aqi = data.list[0].main.aqi * 20;
      const aqiFill = document.getElementById('aqiFill');
      const aqiValue = document.getElementById('aqiValue');
      aqiValue.textContent = `${aqi} / 100`;
      aqiFill.style.width = `${aqi}%`;

      let color;
      if (aqi <= 30) color = '#2ecc71';
      else if (aqi <= 60) color = '#f1c40f';
      else color = '#e74c3c';
      aqiFill.style.background = color;

      updateAlert(aqi);
    }

    function updateAlert(aqi) {
      const section = document.getElementById("alertSection");
      const content = document.getElementById("alertContent");
      section.classList.remove("alert-good", "alert-warning", "alert-danger");

      if (aqi <= 30) {
        section.classList.add("alert-good");
        content.innerHTML = `
          <p>üå§Ô∏è Th·ªùi ti·∫øt hi·ªán t·∫°i r·∫•t t·ªët, kh√¥ng kh√≠ trong l√†nh!</p>
          <p>üåø Th√≠ch h·ª£p ƒë·ªÉ t·∫≠p luy·ªán ngo√†i tr·ªùi ho·∫∑c thi·ªÅn ƒë·ªãnh.</p>`;
      } else if (aqi <= 60) {
        section.classList.add("alert-warning");
        content.innerHTML = `
          <p>‚ö†Ô∏è Kh√¥ng kh√≠ c√≥ ch√∫t √¥ nhi·ªÖm, n√™n h·∫°n ch·∫ø ho·∫°t ƒë·ªông m·∫°nh ngo√†i tr·ªùi.</p>
          <p>üò∑ Mang kh·∫©u trang khi ra ngo√†i ƒë·ªÉ b·∫£o v·ªá s·ª©c kh·ªèe.</p>`;
      } else {
        section.classList.add("alert-danger");
        content.innerHTML = `
          <p>üö® Kh√¥ng kh√≠ √¥ nhi·ªÖm cao, n√™n ·ªü trong nh√†!</p>
          <p>üí® Tr√°nh t·∫≠p luy·ªán c∆∞·ªùng ƒë·ªô cao ngo√†i tr·ªùi, b·∫≠t m√°y l·ªçc kh√¥ng kh√≠ n·∫øu c√≥ th·ªÉ.</p>`;
      }
    }

    function showWeather(data) {
      document.getElementById("cityName").textContent = data.name;
      document.getElementById("weatherDesc").textContent = data.weather[0].description;
      document.getElementById("temp").textContent = `${Math.round(data.main.temp)}¬∞C`;
      document.getElementById("humidity").textContent = `ƒê·ªô ·∫©m: ${data.main.humidity}%`;
      document.getElementById("windSpeed").textContent = `${data.wind.speed} m/s`;
      document.getElementById("visibility").textContent = `${(data.visibility / 1000).toFixed(1)} km`;
      document.getElementById("uvIndex").textContent = Math.floor(Math.random() * 10);
    }

    window.onload = () => getWeather();
  </script>
</body>
</html>
